"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3844],{3844:(e,n,t)=>{t.r(n),t.d(n,{default:()=>Q});var o=t(10467),i=t(94455),r=t(85190),a=t(52749),l=t(81690),s=t(82461),g=t(75629),c=t(74431),_=t(79555),d=t(8014),m=t(15324),p=t(85850),u=t(49588),C=t(63153),f=t(51092),h=t(60378),P=t(21776),S=t(83804),b=t(99622),M=t(18022),O=t(246),v=t(54438);let y=(()=>{var e;class CoreReferrerService{consumeInstallReferrerUrl(){return(0,o.A)((function*(){const e=O.b.plugin("installReferrer");if(!e)return;if(!(yield r.CoreConfig.get(CoreReferrerService.INSTALL_REFERRER_CONSUMED,0)))try{var n;const t=(null!==(n=(yield e.getReferrer()).referrer)&&void 0!==n?n:"").match(/siteurl=([^&]+)/);return null==t?void 0:t[1]}catch{}finally{yield r.CoreConfig.set(CoreReferrerService.INSTALL_REFERRER_CONSUMED,1)}}))()}}return(e=CoreReferrerService).INSTALL_REFERRER_CONSUMED="install_referrer_consumed",e.ɵfac=function CoreReferrerService_Factory(n){return new(n||e)},e.ɵprov=v.jDH({token:e,factory:e.ɵfac,providedIn:"root"}),CoreReferrerService})();const R=(0,_.Qd)(y);var L=t(30454),T=t(84129),x=t(44426),I=t(93589),k=t(68831),w=t(33014),F=t(55554),E=t(85505),G=t(25572),U=t(86654),$=t(89417),j=t(60177),N=t(2910),A=t(69901),Y=t(10892),V=t(86198),H=t(88246),D=t(43570),X=t(73955);const B=["siteFormEl"],_c1=e=>({$a:e}),_c2=e=>({site:e});function CoreLoginSitePage_form_18_ng_container_2_Template(e,n){if(1&e&&(v.qex(0),v.j41(1,"ion-item",15),v.nrm(2,"ion-input",16),v.nI1(3,"translate"),v.nI1(4,"translate"),v.k0s(),v.bVm()),2&e){const e=v.XpG(2);v.R7$(2),v.FS9("placeholder",v.bMT(3,4,"core.login.siteaddressplaceholder")),v.Y8G("core-auto-focus",e.showKeyboard&&!e.showScanQR)("label",v.bMT(4,6,"core.login.siteaddress"))("clearInput",!0)}}function CoreLoginSitePage_form_18_ng_container_3_ion_item_11_Template(e,n){if(1&e){const e=v.RV6();v.j41(0,"ion-item",26),v.nI1(1,"translate"),v.bIt("click",(function CoreLoginSitePage_form_18_ng_container_3_ion_item_11_Template_ion_item_click_0_listener(n){v.eBV(e);const t=v.XpG(3);return v.Njj(t.connect(t.enteredSiteUrl.url,n))})),v.j41(2,"ion-thumbnail",27),v.nrm(3,"ion-icon",28),v.k0s(),v.j41(4,"ion-label")(5,"h2",29),v.EFF(6),v.nI1(7,"translate"),v.k0s(),v.j41(8,"p"),v.EFF(9),v.k0s()()()}if(2&e){const e=v.XpG(3);v.Y8G("detail",!0),v.BMQ("aria-label",v.bMT(1,4,"core.login.connect")),v.R7$(6),v.JRh(v.bMT(7,6,"core.login.yourenteredsite")),v.R7$(3),v.JRh(e.enteredSiteUrl.noProtocolUrl)}}function CoreLoginSitePage_form_18_ng_container_3_div_13_Template(e,n){1&e&&(v.j41(0,"div",30),v.nrm(1,"ion-spinner"),v.nI1(2,"translate"),v.k0s()),2&e&&(v.R7$(),v.BMQ("aria-label",v.bMT(2,1,"core.loading")))}function CoreLoginSitePage_form_18_ng_container_3_ng_container_14_ng_container_1_Template(e,n){1&e&&v.eu8(0)}function CoreLoginSitePage_form_18_ng_container_3_ng_container_14_Template(e,n){if(1&e&&(v.qex(0),v.DNE(1,CoreLoginSitePage_form_18_ng_container_3_ng_container_14_ng_container_1_Template,1,0,"ng-container",31),v.bVm()),2&e){const e=n.$implicit;v.XpG(3);const t=v.sdS(25);v.R7$(),v.Y8G("ngTemplateOutlet",t)("ngTemplateOutletContext",v.eq3(2,_c2,e))}}function CoreLoginSitePage_form_18_ng_container_3_div_15_Template(e,n){1&e&&(v.j41(0,"div",32),v.nrm(1,"ion-spinner"),v.nI1(2,"translate"),v.k0s()),2&e&&(v.R7$(),v.BMQ("aria-label",v.bMT(2,1,"core.loading")))}function CoreLoginSitePage_form_18_ng_container_3_Template(e,n){if(1&e){const e=v.RV6();v.qex(0),v.j41(1,"ion-item",15)(2,"ion-input",17),v.nI1(3,"translate"),v.nI1(4,"translate"),v.bIt("ionInput",(function CoreLoginSitePage_form_18_ng_container_3_Template_ion_input_ionInput_2_listener(n){v.eBV(e);const t=v.XpG(2);return v.Njj(t.searchSite(n,t.siteForm.value.siteUrl))})),v.k0s()(),v.j41(5,"ion-list",18)(6,"ion-item",19)(7,"ion-label")(8,"h2",20),v.EFF(9),v.nI1(10,"translate"),v.k0s()()(),v.DNE(11,CoreLoginSitePage_form_18_ng_container_3_ion_item_11_Template,10,8,"ion-item",21),v.j41(12,"div",22),v.DNE(13,CoreLoginSitePage_form_18_ng_container_3_div_13_Template,3,3,"div",23)(14,CoreLoginSitePage_form_18_ng_container_3_ng_container_14_Template,2,4,"ng-container",24),v.k0s()(),v.DNE(15,CoreLoginSitePage_form_18_ng_container_3_div_15_Template,3,3,"div",25),v.bVm()}if(2&e){const e=v.XpG(2);v.R7$(2),v.FS9("placeholder",v.bMT(3,15,"core.login.siteaddressplaceholder")),v.Y8G("core-auto-focus",e.showKeyboard&&!e.showScanQR)("label",v.bMT(4,17,"core.login.siteaddress"))("clearInput",!0),v.R7$(3),v.AVh("hidden",!e.hasSites&&!e.enteredSiteUrl),v.R7$(4),v.JRh(v.bMT(10,19,"core.login.selectsite")),v.R7$(2),v.Y8G("ngIf",e.enteredSiteUrl),v.R7$(),v.AVh("hidden",!e.hasSites)("dimmed",e.loadingSites),v.R7$(),v.Y8G("ngIf",e.loadingSites),v.R7$(),v.Y8G("ngForOf",e.sites),v.R7$(),v.Y8G("ngIf",!e.hasSites&&e.loadingSites)}}function CoreLoginSitePage_form_18_ion_item_4_Template(e,n){if(1&e&&(v.j41(0,"ion-item")(1,"ion-label")(2,"ion-button",33),v.EFF(3),v.nI1(4,"translate"),v.k0s()()()),2&e){const e=v.XpG(2);v.R7$(2),v.Y8G("disabled",!e.siteForm.valid),v.R7$(),v.SpI(" ",v.bMT(4,2,"core.login.connect")," ")}}function CoreLoginSitePage_form_18_Template(e,n){if(1&e){const e=v.RV6();v.j41(0,"form",14,1),v.bIt("ngSubmit",(function CoreLoginSitePage_form_18_Template_form_ngSubmit_0_listener(n){v.eBV(e);const t=v.XpG();return v.Njj(t.connect(t.siteForm.value.siteUrl,n))})),v.DNE(2,CoreLoginSitePage_form_18_ng_container_2_Template,5,8,"ng-container",12)(3,CoreLoginSitePage_form_18_ng_container_3_Template,16,21,"ng-container",12)(4,CoreLoginSitePage_form_18_ion_item_4_Template,5,4,"ion-item",12),v.k0s()}if(2&e){const e=v.XpG();v.Y8G("formGroup",e.siteForm),v.R7$(2),v.Y8G("ngIf","url"===e.siteSelector),v.R7$(),v.Y8G("ngIf","url"!==e.siteSelector),v.R7$(),v.Y8G("ngIf","url"===e.siteSelector)}}function CoreLoginSitePage_ng_container_19_ion_list_1_ion_searchbar_6_Template(e,n){if(1&e){const e=v.RV6();v.j41(0,"ion-searchbar",35),v.nI1(1,"translate"),v.mxI("ngModelChange",(function CoreLoginSitePage_ng_container_19_ion_list_1_ion_searchbar_6_Template_ion_searchbar_ngModelChange_0_listener(n){v.eBV(e);const t=v.XpG(3);return v.DH7(t.filter,n)||(t.filter=n),v.Njj(n)})),v.bIt("ionInput",(function CoreLoginSitePage_ng_container_19_ion_list_1_ion_searchbar_6_Template_ion_searchbar_ionInput_0_listener(n){v.eBV(e);const t=v.XpG(3);return v.Njj(t.filterChanged(n))}))("ionCancel",(function CoreLoginSitePage_ng_container_19_ion_list_1_ion_searchbar_6_Template_ion_searchbar_ionCancel_0_listener(){v.eBV(e);const n=v.XpG(3);return v.Njj(n.filterChanged())})),v.k0s()}if(2&e){const e=v.XpG(3);v.R50("ngModel",e.filter),v.Y8G("placeholder",v.bMT(1,2,"core.login.findyoursite"))}}function CoreLoginSitePage_ng_container_19_ion_list_1_ng_container_7_ng_container_1_Template(e,n){1&e&&v.eu8(0)}function CoreLoginSitePage_ng_container_19_ion_list_1_ng_container_7_Template(e,n){if(1&e&&(v.qex(0),v.DNE(1,CoreLoginSitePage_ng_container_19_ion_list_1_ng_container_7_ng_container_1_Template,1,0,"ng-container",31),v.bVm()),2&e){const e=n.$implicit;v.XpG(3);const t=v.sdS(25);v.R7$(),v.Y8G("ngTemplateOutlet",t)("ngTemplateOutletContext",v.eq3(2,_c2,e))}}function CoreLoginSitePage_ng_container_19_ion_list_1_Template(e,n){if(1&e&&(v.j41(0,"ion-list")(1,"ion-item")(2,"ion-label")(3,"h2",20),v.EFF(4),v.nI1(5,"translate"),v.k0s()()(),v.DNE(6,CoreLoginSitePage_ng_container_19_ion_list_1_ion_searchbar_6_Template,2,4,"ion-searchbar",34)(7,CoreLoginSitePage_ng_container_19_ion_list_1_ng_container_7_Template,2,4,"ng-container",24),v.k0s()),2&e){const e=v.XpG(2);v.R7$(4),v.JRh(v.bMT(5,3,"core.login.selectsite")),v.R7$(2),v.Y8G("ngIf",e.fixedSites.length>4),v.R7$(),v.Y8G("ngForOf",e.filteredSites)}}function CoreLoginSitePage_ng_container_19_Template(e,n){if(1&e&&(v.qex(0),v.DNE(1,CoreLoginSitePage_ng_container_19_ion_list_1_Template,8,5,"ion-list",12),v.bVm()),2&e){const e=v.XpG();v.R7$(),v.Y8G("ngIf","list"===e.siteSelector)}}function CoreLoginSitePage_ng_container_20_Template(e,n){if(1&e){const e=v.RV6();v.qex(0),v.j41(1,"div",36),v.EFF(2),v.nI1(3,"translate"),v.k0s(),v.j41(4,"ion-button",37),v.bIt("click",(function CoreLoginSitePage_ng_container_20_Template_ion_button_click_4_listener(){v.eBV(e);const n=v.XpG();return v.Njj(n.showInstructionsAndScanQR())})),v.nrm(5,"ion-icon",38),v.EFF(6),v.nI1(7,"translate"),v.k0s(),v.bVm()}2&e&&(v.R7$(2),v.SpI("",v.bMT(3,2,"core.login.or")," "),v.R7$(4),v.SpI(" ",v.bMT(7,4,"core.scanqr")," "))}function CoreLoginSitePage_ng_template_24_ion_thumbnail_1_img_1_Template(e,n){if(1&e&&v.nrm(0,"img",44),2&e){const e=v.XpG(2).site;v.Y8G("url",e.imageurl)}}function CoreLoginSitePage_ng_template_24_ion_thumbnail_1_img_2_Template(e,n){1&e&&v.nrm(0,"img",45)}function CoreLoginSitePage_ng_template_24_ion_thumbnail_1_Template(e,n){if(1&e&&(v.j41(0,"ion-thumbnail",2),v.DNE(1,CoreLoginSitePage_ng_template_24_ion_thumbnail_1_img_1_Template,1,1,"img",42)(2,CoreLoginSitePage_ng_template_24_ion_thumbnail_1_img_2_Template,1,0,"img",43),v.k0s()),2&e){const e=v.XpG().site;v.R7$(),v.Y8G("ngIf",e.imageurl),v.R7$(),v.Y8G("ngIf",!e.imageurl)}}function CoreLoginSitePage_ng_template_24_p_3_Template(e,n){if(1&e&&(v.j41(0,"p",46),v.EFF(1),v.k0s()),2&e){const e=v.XpG().site;v.R7$(),v.JRh(e.title)}}function CoreLoginSitePage_ng_template_24_p_4_Template(e,n){if(1&e&&(v.j41(0,"p"),v.EFF(1),v.k0s()),2&e){const e=v.XpG().site;v.R7$(),v.JRh(e.noProtocolUrl)}}function CoreLoginSitePage_ng_template_24_p_5_Template(e,n){if(1&e&&(v.j41(0,"p"),v.EFF(1),v.k0s()),2&e){const e=v.XpG().site;v.R7$(),v.JRh(e.location)}}function CoreLoginSitePage_ng_template_24_Template(e,n){if(1&e){const e=v.RV6();v.j41(0,"ion-item",39),v.bIt("click",(function CoreLoginSitePage_ng_template_24_Template_ion_item_click_0_listener(n){const t=v.eBV(e).site,o=v.XpG();return v.Njj(o.connect(t.url,n))})),v.DNE(1,CoreLoginSitePage_ng_template_24_ion_thumbnail_1_Template,3,2,"ion-thumbnail",40),v.j41(2,"ion-label"),v.DNE(3,CoreLoginSitePage_ng_template_24_p_3_Template,2,1,"p",41)(4,CoreLoginSitePage_ng_template_24_p_4_Template,2,1,"p",12)(5,CoreLoginSitePage_ng_template_24_p_5_Template,2,1,"p",12),v.k0s()()}if(2&e){const e=n.site,t=v.XpG();v.Y8G("ngClass",e.className)("detail",!0),v.BMQ("aria-label",e.name),v.R7$(),v.Y8G("ngIf",t.siteFinderSettings.displayimage),v.R7$(2),v.Y8G("ngIf",e.title),v.R7$(),v.Y8G("ngIf",t.displaySiteUrl(e.url)),v.R7$(),v.Y8G("ngIf",e.location)}}let Q=(()=>{var e;class CoreLoginSitePage{constructor(e){this.formBuilder=e,this.siteSelector="sitefinder",this.showKeyboard=!1,this.filter="",this.sites=[],this.hasSites=!1,this.loadingSites=!1,this.appName=c.CoreConstants.CONFIG.appname}ngOnInit(){var e=this;return(0,o.A)((function*(){let n="";e.siteSelector=c.CoreConstants.CONFIG.multisitesdisplay;e.siteFinderSettings={displaysitename:!0,displayimage:!0,displayalias:!0,displaycity:!0,displaycountry:!0,displayurl:!0,...c.CoreConstants.CONFIG.sitefindersettings||{}};if((yield s.CoreLoginHelper.getAvailableSites()).length)n=yield e.initSiteSelector();else{var t;n=null!==(t=yield e.consumeInstallReferrerUrl())&&void 0!==t?t:"";const o=c.CoreConstants.CONFIG.enableonboarding&&!M.CorePlatform.isIOS();n?(e.connect(n),o&&r.CoreConfig.set(T.n5,1)):o&&e.initOnboarding()}e.showScanQR=s.CoreLoginHelper.displayQRInSiteScreen(),e.siteForm=e.formBuilder.group({siteUrl:[n,e.moodleUrlValidator()]}),e.searchFunction=l.j.debounce(function(){var n=(0,o.A)((function*(n){if((n=n.trim()).length>=3){const t=yield a.CoreSites.findSites(n);e.sites=e.extendCoreLoginSiteInfo(t),e.hasSites=!!e.sites.length}else e.hasSites=!1;e.loadingSites=!1}));return function(e){return n.apply(this,arguments)}}(),1e3),e.showKeyboard=!!m.CoreNavigator.getRouteBooleanParam("showKeyboard")}))()}initSiteSelector(){var e=this;return(0,o.A)((function*(){const n=yield s.CoreLoginHelper.getAvailableSites();return e.fixedSites=e.extendCoreLoginSiteInfo(n),e.siteSelector="list",e.fixedSites.some((e=>!!e.imageurl))||(e.siteFinderSettings.displayimage=!1),e.filteredSites=e.fixedSites,e.fixedSites[0].url}))()}consumeInstallReferrerUrl(){return(0,o.A)((function*(){const e=yield F.g.ignoreErrors(F.g.timeoutPromise(R.consumeInstallReferrerUrl(),1e3));if(!e)return;return(yield F.g.ignoreErrors(a.CoreSites.getSites(),[])).length>0?void 0:e}))()}initOnboarding(){var e=this;return(0,o.A)((function*(){(yield r.CoreConfig.get(T.n5,!1))||e.showOnboarding()}))()}extendCoreLoginSiteInfo(e){return e.map((e=>{e.noProtocolUrl=this.siteFinderSettings.displayurl&&e.url?d.F.removeUrlParts(e.url,"protocol"):"";const n=this.siteFinderSettings.displaysitename?e.name:"",t=this.siteFinderSettings.displayalias&&e.alias?e.alias:"";e.title=n&&t?`${n} (${t})`:n+t;const o=this.siteFinderSettings.displaycountry&&e.countrycode?E.A.getCountryName(e.countrycode):"",i=this.siteFinderSettings.displaycity&&e.city?e.city:"";return e.location=i&&o?`${i} - ${o}`:i+o,a.CoreSites.hasDefaultImage(e)&&this.siteFinderSettings.defaultimageurl&&(e.imageurl=this.siteFinderSettings.defaultimageurl),e}))}moodleUrlValidator(){return e=>{const n=e.value.trim();let t=n.length>=3&&d.F.isValidMoodleUrl(n);if(!t){!!a.CoreSites.getDemoSiteData(n)&&(t=!0)}return t?null:{siteUrl:{value:e.value}}}}showHelp(){return(0,o.A)((function*(){const{CoreLoginSiteHelpComponent:e}=yield t.e(71470).then(t.bind(t,71470));yield I.I.openModal({component:e,cssClass:"core-modal-fullscreen"})}))()}showOnboarding(){return(0,o.A)((function*(){const{CoreLoginSiteOnboardingComponent:e}=yield t.e(9818).then(t.bind(t,9818));yield I.I.openModal({component:e,cssClass:"core-modal-fullscreen"})}))()}connect(e,n){var t=this;return(0,o.A)((function*(){if(null==n||n.preventDefault(),null==n||n.stopPropagation(),x.p.close(),!e)return G.CoreAlerts.showError(_.HT.instant("core.login.siteurlrequired")),void 0;if(!i.WE.isOnline())return G.CoreAlerts.showError(_.HT.instant("core.networkerrormsg")),void 0;if((e=e.trim()).match(/^(https?:\/\/)?campus\.example\.edu/))return t.showLoginIssue(e,new g.CoreError(_.HT.instant("core.login.errorexampleurl"))),void 0;const o=a.CoreSites.getDemoSiteData(e);if(o)yield t.loginDemoSite(o);else{const n=yield w.CoreLoadings.show();let o;try{o=yield a.CoreSites.checkSite(e,void 0,"Site URL page")}catch(i){const r=d.F.guessMoodleDomain(e);if(!r||r==e)return n.dismiss(),t.showLoginIssue(e,i);try{o=yield a.CoreSites.checkSite(r,void 0,"Site URL page")}catch(o){return n.dismiss(),t.showLoginIssue(e,i||o)}}yield t.login(o),n.dismiss()}}))()}loginDemoSite(e){var n=this;return(0,o.A)((function*(){const t=yield w.CoreLoadings.show();try{const t=yield a.CoreSites.getUserToken(e.url,e.username,e.password);return yield a.CoreSites.newSite(t.siteUrl,t.token,t.privateToken),C.R.triggerFormSubmittedEvent(n.formElement,!0),yield m.CoreNavigator.navigateToSiteHome(),void 0}catch(n){s.CoreLoginHelper.treatUserTokenError(e.url,n,e.username,e.password),n.loggedout&&m.CoreNavigator.navigate("/login/sites",{reset:!0})}finally{t.dismiss()}}))()}login(e){var n=this;return(0,o.A)((function*(){try{yield a.CoreSites.checkApplication(e.config),C.R.triggerFormSubmittedEvent(n.formElement,!0),m.CoreNavigator.navigate("/login/credentials",{params:{siteCheck:e}})}catch{}}))()}showLoginIssue(e,n){var t=this;return(0,o.A)((function*(){let o,i,r,a,l=G.CoreAlerts.getErrorMessage(n);if(n instanceof f.CoreSiteError&&(a=n.supportConfig,r=a instanceof S.Q?a.getSite():void 0,o=n.debug,s.CoreLoginHelper.isAppUnsupportedError(n)))return yield s.CoreLoginHelper.showAppUnsupportedModal(e,r,o),void 0;n instanceof b.CoreLoginError&&(i=n.title),o&&(l=`<p>${l}</p><div class="core-error-accordion-container"></div>`);const g=a,c=[{text:_.HT.instant("core.tryagain"),role:"cancel"},null!=g&&g.canContactSupport()?{text:_.HT.instant("core.contactsupport"),handler:()=>{var e,n;return h.I.contact({supportConfig:g,subject:_.HT.instant("core.cannotconnect"),message:`Error: ${null===(e=o)||void 0===e?void 0:e.code}\n\n${null===(n=o)||void 0===n?void 0:n.details}`})}}:r?null:{text:_.HT.instant("core.needhelp"),cssClass:"core-login-need-help",handler:()=>t.showHelp()}].filter((e=>!!e)),d=yield G.CoreAlerts.show({header:null!=i?i:_.HT.instant("core.cannotconnect"),message:null!=l?l:_.HT.instant("core.sitenotfoundhelp"),buttons:c});if(o){const e=d.querySelector(".core-error-accordion-container");e&&(yield P.S.render(e,o.details,o.code))}}))()}filterChanged(e){var n;const t=null==e||null===(n=e.target.value)||void 0===n?void 0:n.trim().toLowerCase();this.filteredSites=t&&this.fixedSites?this.fixedSites.filter((e=>e.title.toLowerCase().indexOf(t)>-1||e.noProtocolUrl.toLowerCase().indexOf(t)>-1||e.location.toLowerCase().indexOf(t)>-1)):this.fixedSites}searchSite(e,n){this.loadingSites=!0,n=n.trim(),this.enteredSiteUrl=this.siteForm.valid&&n.length>=3?{url:n,name:"connect",title:"",location:"",noProtocolUrl:d.F.removeUrlParts(n,"protocol")}:void 0,this.searchFunction(n.trim())}showInstructionsAndScanQR(){var e=this;return(0,o.A)((function*(){try{yield s.CoreLoginHelper.showScanQRInstructions(),yield e.scanQR()}catch{}}))()}scanQR(){var e=this;return(0,o.A)((function*(){const n=yield k.CoreQRScan.scanQR();if(!n)return;if(p.CoreCustomURLSchemes.isCustomURL(n)){try{yield p.CoreCustomURLSchemes.handleCustomURL(n)}catch(t){t&&t.data&&t.data.isAuthenticationURL&&t.data.siteUrl?e.treatErrorInAuthenticationCustomURL(n,t):p.CoreCustomURLSchemes.treatHandleCustomURLError(t,n,"CoreLoginSitePage")}return}const t=d.F.getUrlProtocol(n);if(t&&"http"!=t&&"https"!=t)return G.CoreAlerts.showError(_.HT.instant("core.errorurlschemeinvalidscheme",{$a:n})),void 0;(yield s.CoreLoginHelper.isSiteUrlAllowed(n))?(e.siteForm.controls.siteUrl.setValue(n),e.connect(n)):G.CoreAlerts.showError(_.HT.instant("core.errorurlschemeinvalidsite"))}))()}treatErrorInAuthenticationCustomURL(e,n){var t=this;return(0,o.A)((function*(){var o;const i=(null===(o=n.data)||void 0===o?void 0:o.siteUrl)||"",r=yield w.CoreLoadings.show();t.siteForm.controls.siteUrl.setValue(i);try{const e=yield a.CoreSites.checkSite(i,void 0,"Site URL page");yield a.CoreSites.checkApplication(e.config),s.CoreLoginHelper.isSSOLoginNeeded(e.code)||(yield m.CoreNavigator.navigate("/login/credentials",{params:{siteCheck:e}}))}catch{}finally{r.dismiss()}n.error=u.CoreErrorHelper.addTextToError(n.error,`<br><br>${_.HT.instant("core.login.youcanstillconnectwithcredentials")}`),p.CoreCustomURLSchemes.treatHandleCustomURLError(n,e,"CoreLoginSitePage")}))()}openSettings(){m.CoreNavigator.navigate("/settings")}displaySiteUrl(e){return L.a.makeUnauthenticatedSite(e).shouldDisplayInformativeLinks()}}return(e=CoreLoginSitePage).ɵfac=function CoreLoginSitePage_Factory(n){return new(n||e)(v.rXU($.ok))},e.ɵcmp=v.VBU({type:e,selectors:[["page-core-login-site"]],viewQuery:function CoreLoginSitePage_Query(e,n){if(1&e&&v.GBs(B,5),2&e){let e;v.mGM(e=v.lsd())&&(n.formElement=e.first)}},standalone:!0,features:[v.aNF],decls:26,vars:23,consts:[["sitelisting",""],["siteFormEl",""],["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click","ariaLabel"],["slot","icon-only","name","fas-gear","aria-hidden","true"],[1,"ion-padding"],[1,"list-item-limited-width"],[1,"ion-text-center","ion-padding","ion-margin-bottom","core-login-site-logo"],["src","assets/img/login_logo.png",1,"avatar-full","login-logo",3,"alt"],[3,"formGroup","ngSubmit",4,"ngIf"],[4,"ngIf"],["aria-haspopup","dialog","expand","block","fill","clear",1,"ion-margin-top","core-login-need-help","core-button-as-link","ion-text-wrap",3,"click"],[3,"ngSubmit","formGroup"],["lines","inset"],["name","url","type","url","formControlName","siteUrl","labelPlacement","stacked",3,"placeholder","core-auto-focus","label","clearInput"],["name","url","formControlName","siteUrl","labelPlacement","stacked",3,"ionInput","placeholder","core-auto-focus","label","clearInput"],[1,"core-login-site-list"],[1,"core-login-site-list-title"],[1,"item-heading"],["button","","class","core-login-entered-site",3,"detail","click",4,"ngIf"],[1,"core-login-site-list-found"],["class","core-login-site-list-loading",4,"ngIf"],[4,"ngFor","ngForOf"],["class","core-login-site-nolist-loading",4,"ngIf"],["button","",1,"core-login-entered-site",3,"click","detail"],["slot","start","aria-hidden","true"],["name","fas-pen","aria-hidden","true"],[1,"ion-text-wrap"],[1,"core-login-site-list-loading"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"core-login-site-nolist-loading"],["expand","block","type","submit",1,"ion-text-wrap",3,"disabled"],[3,"ngModel","placeholder","ngModelChange","ionInput","ionCancel",4,"ngIf"],[3,"ngModelChange","ionInput","ionCancel","ngModel","placeholder"],[1,"ion-text-center","ion-padding","ion-margin-top","core-login-site-qrcode-separator"],["expand","block","fill","outline","aria-haspopup","dialog",1,"ion-margin","core-login-site-qrcode",3,"click"],["slot","start","name","fas-qrcode","aria-hidden","true"],["button","",3,"click","ngClass","detail"],["slot","start",4,"ngIf"],["class","item-heading ion-text-wrap",4,"ngIf"],["core-external-content","","onError","this.src='assets/icon/icon.png'","alt","","role","presentation",3,"url",4,"ngIf"],["src","assets/icon/icon.png","class","core-login-default-icon","alt","","role","presentation",4,"ngIf"],["core-external-content","","onError","this.src='assets/icon/icon.png'","alt","","role","presentation",3,"url"],["src","assets/icon/icon.png","alt","","role","presentation",1,"core-login-default-icon"],[1,"item-heading","ion-text-wrap"]],template:function CoreLoginSitePage_Template(e,n){if(1&e){const e=v.RV6();v.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",2),v.nrm(3,"ion-back-button",3),v.nI1(4,"translate"),v.k0s(),v.j41(5,"ion-title")(6,"h1"),v.EFF(7),v.nI1(8,"translate"),v.k0s()(),v.j41(9,"ion-buttons",4)(10,"ion-button",5),v.nI1(11,"translate"),v.bIt("click",(function CoreLoginSitePage_Template_ion_button_click_10_listener(){return v.eBV(e),v.Njj(n.openSettings())})),v.nrm(12,"ion-icon",6),v.k0s()()()(),v.j41(13,"ion-content",7)(14,"div",8)(15,"div",9),v.nrm(16,"img",10),v.nI1(17,"translate"),v.k0s(),v.DNE(18,CoreLoginSitePage_form_18_Template,5,4,"form",11)(19,CoreLoginSitePage_ng_container_19_Template,2,1,"ng-container",12)(20,CoreLoginSitePage_ng_container_20_Template,8,6,"ng-container",12),v.j41(21,"ion-button",13),v.bIt("click",(function CoreLoginSitePage_Template_ion_button_click_21_listener(){return v.eBV(e),v.Njj(n.showHelp())})),v.EFF(22),v.nI1(23,"translate"),v.k0s()()(),v.DNE(24,CoreLoginSitePage_ng_template_24_Template,6,7,"ng-template",null,0,v.C5r)}2&e&&(v.R7$(3),v.Y8G("text",v.bMT(4,10,"core.back")),v.R7$(4),v.JRh(v.bMT(8,12,"core.login.connecttomoodle")),v.R7$(3),v.Y8G("ariaLabel",v.bMT(11,14,"core.settings.appsettings")),v.R7$(5),v.AVh("hidden",n.hasSites||n.enteredSiteUrl),v.R7$(),v.Y8G("alt",v.i5U(17,16,"core.login.logoof",v.eq3(21,_c1,n.appName))),v.R7$(2),v.Y8G("ngIf",!n.fixedSites&&n.siteForm),v.R7$(),v.Y8G("ngIf",n.fixedSites),v.R7$(),v.Y8G("ngIf",n.showScanQR&&!n.hasSites&&!n.enteredSiteUrl),v.R7$(2),v.SpI(" ",v.bMT(23,19,"core.needhelp")," "))},dependencies:[U.n,j.YU,j.Sq,j.bT,j.T3,$.qT,$.BC,$.cb,$.vS,N.Jm,N.QW,N.W9,N.eU,N.iq,N.$w,N.uz,N.he,N.nf,N.S1,N.w2,N.Zx,N.BC,N.ai,N.Gw,N.el,$.j4,$.JD,A.i,Y.l,V.t,H.i,D.T,X.D9],styles:["[_nghost-%COMP%]{--list-item-max-width: 600px}.core-login-site-connect[_ngcontent-%COMP%]{margin-top:1.4rem}.item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]{min-width:50px;min-height:50px;width:50px;height:50px;border-radius:20%;box-shadow:0 0 4px var(--gray-200);text-align:center;overflow:hidden}.item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:50px;max-width:fit-content;width:auto;height:auto;margin:0 auto 0 50%;transform:translate3d(-50%,0,0);object-fit:cover;object-position:50% 50%}[dir=rtl][_nghost-%COMP%]   .item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   .item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{transform:translate3d(50%,0,0)}[dir=rtl][_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{transform:translate3d(50%,0,0)}@supports selector(:dir(rtl)){.item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]:dir(rtl){transform:translate3d(50%,0,0)}}.item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin:0 auto;font-size:2.1875rem;height:50px}[dir=rtl][_nghost-%COMP%]   .item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   .item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-left:0;margin-right:50%}.core-login-site-logo[_ngcontent-%COMP%], .core-login-site-list[_ngcontent-%COMP%], .core-login-site-list-found[_ngcontent-%COMP%]{visibility:visible;opacity:1;transition:all .7s ease-in-out;max-height:9999px}.core-login-site-logo.hidden[_ngcontent-%COMP%], .core-login-site-list.hidden[_ngcontent-%COMP%], .core-login-site-list-found.hidden[_ngcontent-%COMP%]{opacity:0;visibility:hidden;margin-top:0;margin-bottom:0;padding:0;max-height:0;display:block!important}.core-login-site-list-found.dimmed[_ngcontent-%COMP%]{pointer-events:none;position:relative}.core-login-site-list-loading[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;left:0;right:0;width:100%;height:100%;display:flex;align-content:center;align-items:center;background-color:#ffffff80;z-index:1}.core-login-site-list-loading[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{margin:0 auto}.core-login-site-nolist-loading[_ngcontent-%COMP%]{margin-top:16px;text-align:center}.item.core-login-site-list-title[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], .item.core-login-site-list-title[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2.item-heading[_ngcontent-%COMP%]{margin-top:0}@media (min-width: 768px){ion-content[_ngcontent-%COMP%]   .core-login-site-logo[_ngcontent-%COMP%]{margin-top:20%}ion-content[_ngcontent-%COMP%]   .core-login-site-logo.hidden[_ngcontent-%COMP%]{margin-top:0}}.core-login-entered-site[_ngcontent-%COMP%]{background-color:var(--light)}.core-login-entered-site[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]{box-shadow:0 0 4px var(--gray-300)}.core-login-default-icon[_ngcontent-%COMP%]{filter:grayscale(100%)}",'[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]{--background: var(--core-login-background);--ion-item-background: var(--core-login-background);--color: var(--core-login-text-color)}[_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{--color: var(--core-login-text-color)}[_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   .core-oauth-icon[_ngcontent-%COMP%]{color:var(--color)}[_nghost-%COMP%]   ion-button.core-button-as-link[_ngcontent-%COMP%]{--color: var(--core-login-text-color);text-decoration-color:var(--color)}[_nghost-%COMP%]   .core-login-reconnect-warning[_ngcontent-%COMP%]{margin:0 0 32px}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]{margin-bottom:32px}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%]   core-site-logo[_ngcontent-%COMP%]{--core-site-logo-max-height: 104px;--core-site-logo-sitename-margin-bottom: 8px;--core-site-logo-sitename-font: var(--mdl-typography-subtitle-font-lg);--core-site-logo-max-width: 300px;--core-site-logo-width: 90%;--core-site-logo-margin: 0 auto}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%]   .core-siteurl[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:0}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%] + .core-login-user[_ngcontent-%COMP%]{margin-top:24px}[_nghost-%COMP%]   core-user-avatar.large-avatar[_ngcontent-%COMP%]{--core-avatar-size: var(--core-large-avatar-size)}[_nghost-%COMP%]   .core-login-fullname[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:0}[_nghost-%COMP%]   .core-login-methods[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%], [_nghost-%COMP%]   .core-login-methods[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{--background: var(--core-login-input-background);--color: var(--core-login-input-color)}[_nghost-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-left:0;margin-right:0}[_nghost-%COMP%]   .core-login-forgotten-password[_ngcontent-%COMP%]{text-decoration:underline}[_nghost-%COMP%]   .core-login-methods-separator[_ngcontent-%COMP%]{position:relative;padding:8px 0}[_nghost-%COMP%]   .core-login-methods-separator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:var(--core-login-background);padding:0 8px}[_nghost-%COMP%]   .core-login-methods-separator[_ngcontent-%COMP%]:before{height:1px;position:absolute;top:50%;left:0;right:0;border-bottom:1px solid var(--gray-300);content:"";z-index:-1}[_nghost-%COMP%]   .core-login-login-button[_ngcontent-%COMP%]{margin-top:32px}[_nghost-%COMP%]   .core-login-login-inbrowser-button[_ngcontent-%COMP%]{margin-bottom:8px}[_nghost-%COMP%]   p.core-login-inbrowser[_ngcontent-%COMP%]{font:var(--mdl-typography-body-font-sm);margin-top:8px;margin-bottom:8px}[_nghost-%COMP%]   .core-login-sign-up[_ngcontent-%COMP%]{margin-top:8px;border-top:1px solid var(--gray-300)}[_nghost-%COMP%]   .core-login-identity-providers[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], [_nghost-%COMP%]   .core-login-sign-up[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:8px;font:var(--mdl-typography-heading6-font)}:root.dark[_nghost-%COMP%]   core-loading[_ngcontent-%COMP%], :root.dark   [_nghost-%COMP%]   core-loading[_ngcontent-%COMP%]{--loading-background: var(--core-login-background-dark);--loading-text-color: #ffffff;--loading-spinner: #ffffff}']}),CoreLoginSitePage})()}}]);