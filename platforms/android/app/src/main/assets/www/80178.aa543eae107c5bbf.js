"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[80178],{80178:(e,s,r)=>{r.r(s),r.d(s,{AddonModWorkshopHelper:()=>S,AddonModWorkshopHelperProvider:()=>b});var o=r(10467),t=r(75629),i=r(16082),n=r(45507),d=r(88436),l=r(52749),a=r(75383),u=r(81690),m=r(79555),c=r(65964),p=r(67193),f=r(26327),g=r(81552),h=r(55554),A=r(58364),F=r(94455),k=r(54438);let b=(()=>{var e;class AddonModWorkshopHelperProvider{getTask(e,s){return e.find((e=>e.code==s))}isTaskDone(e,s){const r=this.getTask(e,s);return!r||!!r.completed}canSubmit(e,s,r){const o=e.useexamples&&1==e.examplesmode,t=s.canmanageexamples||0==e.examplesmode||this.isTaskDone(r,"examples");return e.phase>10&&s.cansubmit&&(!o||t)}canAssess(e,s){return!(e.useexamples&&2==e.examplesmode)||s.canmanageexamples}canAddFeedback(e,s){return 40===e.phase&&s.canoverridegrades}canEditAssessments(e,s){return 30===e.phase&&this.canAssess(e,s)&&s.assessingallowed&&s.canpeerassess}getUserSubmission(e,s={}){return(0,o.A)((function*(){const r=s.userId||l.CoreSites.getCurrentSiteUserId();return(yield p.AddonModWorkshop.getSubmissions(e,s)).find((e=>e.authorid==r))}))()}getSubmissionById(e,s,r={}){return(0,o.A)((function*(){try{const o=yield p.AddonModWorkshop.getSubmission(e,s,r);if(!1!==r.filter||F.WE.isOnline())return o;const t=yield h.g.ignoreErrors(p.AddonModWorkshop.getSubmissions(e,{readingStrategy:0})),i=null==t?void 0:t.find((e=>e.id===s));return i&&i.timemodified>o.timemodified?i:o}catch{const o=(yield p.AddonModWorkshop.getSubmissions(e,r)).find((e=>e.id==s));if(!o)throw new t.CoreError("Submission not found");return o}}))()}getReviewerAssessmentById(e,s,r={}){return(0,o.A)((function*(){let o;try{o=yield p.AddonModWorkshop.getAssessment(e,s,r)}catch(t){if(o=(yield p.AddonModWorkshop.getReviewerAssessments(e,r)).find((e=>e.id===s)),!o)throw t}return o.form=yield p.AddonModWorkshop.getAssessmentForm(e,s,{cmId:r.cmId,siteId:r.siteId}),o}))()}getReviewerAssessments(e,s={}){var r=this;return(0,o.A)((function*(){s.siteId=s.siteId||l.CoreSites.getCurrentSiteId();const o=yield p.AddonModWorkshop.getReviewerAssessments(e,s),t=[];return o.forEach((o=>{const i=A.T.without(s,["canAssess","filter"]);t.push(r.getSubmissionById(e,o.submissionid,i).then((e=>{o.submission=e}))),t.push(p.AddonModWorkshop.getAssessmentForm(e,o.id,i).then((e=>{o.form=e})))})),yield Promise.all(t),o}))()}deleteSubmissionStoredFiles(e,s){return(0,o.A)((function*(){const r=yield f.AddonModWorkshopOffline.getSubmissionFolder(e,s);yield h.g.ignoreErrors(n.CoreFile.removeDir(r))}))()}storeSubmissionFiles(e,s,r){return(0,o.A)((function*(){const o=yield f.AddonModWorkshopOffline.getSubmissionFolder(e,r);return i.CoreFileUploader.storeFilesToUpload(o,s)}))()}uploadOrStoreSubmissionFiles(e,s,r,o){return r?this.storeSubmissionFiles(e,s,o):i.CoreFileUploader.uploadOrReuploadFiles(s,g.Ug,e,o)}getStoredSubmissionFiles(e,s){return(0,o.A)((function*(){const r=yield f.AddonModWorkshopOffline.getSubmissionFolder(e,s);return h.g.ignoreErrors(i.CoreFileUploader.getStoredFiles(r),[])}))()}getSubmissionFilesFromOfflineFilesObject(e,s,r){return(0,o.A)((function*(){const o=yield f.AddonModWorkshopOffline.getSubmissionFolder(s,r);return i.CoreFileUploader.getStoredFilesFromOfflineFilesObject(e,o)}))()}deleteAssessmentStoredFiles(e,s,r){return(0,o.A)((function*(){const o=yield f.AddonModWorkshopOffline.getAssessmentFolder(e,s,r);yield h.g.ignoreErrors(n.CoreFile.removeDir(o))}))()}storeAssessmentFiles(e,s,r,t){return(0,o.A)((function*(){const o=yield f.AddonModWorkshopOffline.getAssessmentFolder(e,s,t);return i.CoreFileUploader.storeFilesToUpload(o,r)}))()}uploadOrStoreAssessmentFiles(e,s,r,o,t){return o?this.storeAssessmentFiles(e,s,r,t):i.CoreFileUploader.uploadOrReuploadFiles(r,g.Ug,e,t)}getStoredAssessmentFiles(e,s,r){return(0,o.A)((function*(){const o=yield f.AddonModWorkshopOffline.getAssessmentFolder(e,s,r);return h.g.ignoreErrors(i.CoreFileUploader.getStoredFiles(o),[])}))()}getAssessmentFilesFromOfflineFilesObject(e,s,r,t){return(0,o.A)((function*(){const o=yield f.AddonModWorkshopOffline.getAssessmentFolder(s,r,t);return i.CoreFileUploader.getStoredFilesFromOfflineFilesObject(e,o)}))()}applyOfflineData(e,s=[]){var r=this;return(0,o.A)((function*(){if(0===s.length)return e;const o=null!=e?e:{id:0,workshopid:0,title:"",content:"",timemodified:0,example:!1,authorid:0,timecreated:0,contenttrust:0,attachment:0,published:!1,late:0};let t;const i=s[0].workshopid;return s.forEach((s=>{if("add"===s.action||s.submissionid===o.id)switch(s.action){case"add":case"update":o.title=s.title,o.content=d.CoreFileHelper.replacePluginfileUrls(s.content,(null==e?void 0:e.contentfiles)||[]),o.courseid=s.courseid,o.submissionmodified=s.timemodified/1e3,o.offline=!0,t=s.attachmentsid;break;case"delete":o.deleted=!0,o.submissionmodified=s.timemodified/1e3}})),o.attachmentfiles=t?yield r.getSubmissionFilesFromOfflineFilesObject(t,i):[],o}))()}prepareAssessmentData(e,s,r,t,i=0){return(0,o.A)((function*(){var o;if(2==e.overallfeedbackmode&&!r){throw{feedbackauthor:m.HT.instant("core.err_required")}}const n=(yield c.AddonWorkshopAssessmentStrategyDelegate.prepareAssessmentData(null!==(o=e.strategy)&&void 0!==o?o:"",s,t))||{};return n.feedbackauthor=r,n.feedbackauthorformat=a.C9,n.feedbackauthorattachmentsid=i,n.nodims=t.dimenssionscount,n}))()}realGradeValueHelper(e,s=0,r=0){return"string"==typeof e?e:null!=e?0===s?"0":(e=a.Ni.roundToDecimals(s*e/100,r),u.j.formatFloat(e)):void 0}realGradeValue(e,s){return s.grade=this.realGradeValueHelper(s.grade,e.grade,e.gradedecimals),s.gradinggrade=this.realGradeValueHelper(s.gradinggrade,e.gradinggrade,e.gradedecimals),s.gradinggradeover=this.realGradeValueHelper(s.gradinggradeover,e.gradinggrade,e.gradedecimals),s}showGrade(e){return null!=e}}return(e=AddonModWorkshopHelperProvider).ɵfac=function AddonModWorkshopHelperProvider_Factory(s){return new(s||e)},e.ɵprov=k.jDH({token:e,factory:e.ɵfac,providedIn:"root"}),AddonModWorkshopHelperProvider})();const S=(0,m.Qd)(b)}}]);